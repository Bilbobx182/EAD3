{"version":3,"sources":["../src/SchemaBuilder.js"],"names":["graphql","GraphQLSchema","debug","INDENT","SchemaBuilder","_busy","_watching","watchers","unwatchers","depth","hooks","build","init","GraphQLObjectType","GraphQLInputObjectType","GraphQLEnumType","name","_currentPluginName","hookName","fn","Error","displayName","push","input","context","debugStr","repeat","newObj","hook","hookDisplayName","listen","unlisten","initialBuild","applyHooks","scope","filter","key","_generatedSchema","createBuild","newWithHooks","isSchema","listener","_explicitSchemaListener","triggerChange","emit","buildSchema","on","removeListener"],"mappings":"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","file":"SchemaBuilder.js","sourcesContent":["// @flow\nimport debugFactory from \"debug\";\nimport makeNewBuild from \"./makeNewBuild\";\nimport { bindAll } from \"./utils\";\nimport * as graphql from \"graphql\";\nimport type {\n  GraphQLType,\n  GraphQLNamedType,\n  GraphQLInterfaceType,\n  GraphQLObjectTypeConfig,\n} from \"graphql\";\nimport EventEmitter from \"events\";\nimport type {\n  simplifyParsedResolveInfoFragmentWithType,\n  getAliasFromResolveInfo,\n  parseResolveInfo,\n} from \"graphql-parse-resolve-info\";\nimport type { GraphQLResolveInfo } from \"graphql/type/definition\";\n\nimport type { FieldWithHooksFunction } from \"./makeNewBuild\";\nconst { GraphQLSchema } = graphql;\n\nconst debug = debugFactory(\"graphile-builder\");\n\nconst INDENT = \"  \";\n\nexport type Options = {\n  [string]: mixed,\n};\n\nexport type Plugin = (\n  builder: SchemaBuilder,\n  options: Options\n) => Promise<void> | void;\n\ntype TriggerChangeType = () => void;\n\nexport type DataForType = {\n  [string]: Array<mixed>,\n};\n\nexport type Build = {|\n  graphileBuildVersion: string,\n  graphql: {\n    GraphQLSchema: typeof graphql.GraphQLSchema,\n    GraphQLScalarType: typeof graphql.GraphQLScalarType,\n    GraphQLObjectType: typeof graphql.GraphQLObjectType,\n    GraphQLInterfaceType: typeof graphql.GraphQLInterfaceType,\n    GraphQLUnionType: typeof graphql.GraphQLUnionType,\n    GraphQLEnumType: typeof graphql.GraphQLEnumType,\n    GraphQLInputObjectType: typeof graphql.GraphQLInputObjectType,\n    GraphQLList: typeof graphql.GraphQLList,\n    GraphQLNonNull: typeof graphql.GraphQLNonNull,\n    GraphQLDirective: typeof graphql.GraphQLDirective,\n    TypeKind: typeof graphql.TypeKind,\n    DirectiveLocation: typeof graphql.DirectiveLocation,\n    GraphQLInt: typeof graphql.GraphQLInt,\n    GraphQLFloat: typeof graphql.GraphQLFloat,\n    GraphQLString: typeof graphql.GraphQLString,\n    GraphQLBoolean: typeof graphql.GraphQLBoolean,\n    GraphQLID: typeof graphql.GraphQLID,\n    specifiedDirectives: typeof graphql.specifiedDirectives,\n    GraphQLIncludeDirective: typeof graphql.GraphQLIncludeDirective,\n    GraphQLSkipDirective: typeof graphql.GraphQLSkipDirective,\n    GraphQLDeprecatedDirective: typeof graphql.GraphQLDeprecatedDirective,\n    DEFAULT_DEPRECATION_REASON: typeof graphql.DEFAULT_DEPRECATION_REASON,\n    SchemaMetaFieldDef: typeof graphql.SchemaMetaFieldDef,\n    TypeMetaFieldDef: typeof graphql.TypeMetaFieldDef,\n    TypeNameMetaFieldDef: typeof graphql.TypeNameMetaFieldDef,\n    __Schema: typeof graphql.__Schema,\n    __Directive: typeof graphql.__Directive,\n    __DirectiveLocation: typeof graphql.__DirectiveLocation,\n    __Type: typeof graphql.__Type,\n    __Field: typeof graphql.__Field,\n    __InputValue: typeof graphql.__InputValue,\n    __EnumValue: typeof graphql.__EnumValue,\n    __TypeKind: typeof graphql.__TypeKind,\n    isType: (type: mixed) => boolean,\n    isInputType: (type: GraphQLType) => boolean,\n    isOutputType: (type: GraphQLType) => boolean,\n    isLeafType: (type: GraphQLType) => boolean,\n    isCompositeType: (type: GraphQLType) => boolean,\n    isAbstractType: (type: GraphQLType) => boolean,\n    isNamedType: (type: GraphQLType) => boolean,\n    assertType: typeof graphql.assertType,\n    assertInputType: typeof graphql.assertInputType,\n    assertOutputType: typeof graphql.assertOutputType,\n    assertLeafType: typeof graphql.assertLeafType,\n    assertCompositeType: typeof graphql.assertCompositeType,\n    assertAbstractType: typeof graphql.assertAbstractType,\n    assertNamedType: typeof graphql.assertNamedType,\n    //getNullableType<T: GraphQLType>(type: ?T): ?(T & GraphQLNullableType),\n    getNullableType<T: GraphQLType>(type: ?T): mixed,\n    getNamedType: (type: GraphQLType) => GraphQLNamedType,\n  },\n  parseResolveInfo: parseResolveInfo,\n  simplifyParsedResolveInfoFragmentWithType: simplifyParsedResolveInfoFragmentWithType,\n  getAliasFromResolveInfo: getAliasFromResolveInfo,\n  resolveAlias(\n    data: {},\n    _args: mixed,\n    _context: mixed,\n    resolveInfo: GraphQLResolveInfo\n  ): string,\n  addType(type: GraphQLNamedType): void,\n  getTypeByName(typeName: string): ?GraphQLType,\n  extend<Obj1: *, Obj2: *>(base: Obj1, extra: Obj2, hint?: string): Obj1 & Obj2,\n  newWithHooks<T: GraphQLNamedType | GraphQLSchema>(\n    Class<T>,\n    spec: {},\n    scope: {},\n    returnNullOnInvalid?: boolean\n  ): ?T,\n  fieldDataGeneratorsByType: Map<*, *>, // @deprecated - use fieldDataGeneratorsByFieldNameByType instead\n  fieldDataGeneratorsByFieldNameByType: Map<*, *>,\n  fieldArgDataGeneratorsByFieldNameByType: Map<*, *>,\n|};\n\nexport type BuildExtensionQuery = {|\n  $$isQuery: Symbol,\n|};\n\nexport type Scope = {\n  [string]: mixed,\n};\n\nexport type Context = {|\n  scope: Scope,\n  type: string,\n  [string]: mixed,\n|};\n\ntype DataGeneratorFunction = () => {};\n\nexport type ContextGraphQLObjectTypeFields = {|\n  addDataGeneratorForField: (\n    fieldName: string,\n    fn: DataGeneratorFunction\n  ) => void,\n  recurseDataGeneratorsForField: (fieldName: string) => void,\n  Self: GraphQLNamedType,\n  GraphQLObjectType: GraphQLObjectTypeConfig<*, *>,\n  fieldWithHooks: FieldWithHooksFunction,\n|};\n\ntype SupportedHookTypes = {} | Build | Array<GraphQLInterfaceType>;\n\nexport type Hook<\n  Type: SupportedHookTypes,\n  BuildExtensions: {},\n  ContextExtensions: {}\n> = (\n  input: Type,\n  build: {| ...Build, ...BuildExtensions |},\n  context: {| ...Context, ...ContextExtensions |}\n) => Type;\n\nexport type WatchUnwatch = (triggerChange: TriggerChangeType) => void;\n\nexport type SchemaListener = (newSchema: GraphQLSchema) => void;\n\nclass SchemaBuilder extends EventEmitter {\n  watchers: Array<WatchUnwatch>;\n  unwatchers: Array<WatchUnwatch>;\n  triggerChange: ?TriggerChangeType;\n  depth: number;\n  hooks: {\n    [string]: Array<Hook<*, *, *>>,\n  };\n\n  _currentPluginName: ?string;\n  _generatedSchema: ?GraphQLSchema;\n  _explicitSchemaListener: ?SchemaListener;\n  _busy: boolean;\n  _watching: boolean;\n\n  constructor() {\n    super();\n\n    this._busy = false;\n    this._watching = false;\n\n    this.watchers = [];\n    this.unwatchers = [];\n\n    // Because hooks can nest, this keeps track of how deep we are.\n    this.depth = -1;\n\n    this.hooks = {\n      // The build object represents the current schema build and is passed to\n      // all hooks, hook the 'build' event to extend this object:\n      build: [],\n\n      // 'build' phase should not generate any GraphQL objects (because the\n      // build object isn't finalised yet so it risks weirdness occurring); so\n      // if you need to set up any global types you can do so here.\n      init: [],\n\n      // Add 'query', 'mutation' or 'subscription' types in this hook:\n      GraphQLSchema: [],\n\n      // When creating a GraphQLObjectType via `newWithHooks`, we'll\n      // execute, the following hooks:\n      // - 'GraphQLObjectType' to add any root-level attributes, e.g. add a description\n      // - 'GraphQLObjectType:interfaces' to add additional interfaces to this object type\n      // - 'GraphQLObjectType:fields' to add additional fields to this object type (is\n      //   ran asynchronously and gets a reference to the final GraphQL Object as\n      //   `Self` in the context)\n      // - 'GraphQLObjectType:fields:field' to customise an individual field from above\n      // - 'GraphQLObjectType:fields:field:args' to customize the arguments to a field\n      GraphQLObjectType: [],\n      \"GraphQLObjectType:interfaces\": [],\n      \"GraphQLObjectType:fields\": [],\n      \"GraphQLObjectType:fields:field\": [],\n      \"GraphQLObjectType:fields:field:args\": [],\n\n      // When creating a GraphQLInputObjectType via `newWithHooks`, we'll\n      // execute, the following hooks:\n      // - 'GraphQLInputObjectType' to add any root-level attributes, e.g. add a description\n      // - 'GraphQLInputObjectType:fields' to add additional fields to this object type (is\n      //   ran asynchronously and gets a reference to the final GraphQL Object as\n      //   `Self` in the context)\n      // - 'GraphQLInputObjectType:fields:field' to customise an individual field from above\n      GraphQLInputObjectType: [],\n      \"GraphQLInputObjectType:fields\": [],\n      \"GraphQLInputObjectType:fields:field\": [],\n\n      // When creating a GraphQLEnumType via `newWithHooks`, we'll\n      // execute, the following hooks:\n      // - 'GraphQLEnumType' to add any root-level attributes, e.g. add a description\n      // - 'GraphQLEnumType:values' to add additional values\n      // - 'GraphQLEnumType:values:value' to change an individual value\n      GraphQLEnumType: [],\n      \"GraphQLEnumType:values\": [],\n      \"GraphQLEnumType:values:value\": [],\n    };\n  }\n\n  _setPluginName(name: ?string) {\n    this._currentPluginName = name;\n  }\n\n  /*\n   * Every hook `fn` takes three arguments:\n   * - obj - the object currently being inspected\n   * - build - the current build object (which contains a number of utilities and the context of the build)\n   * - context - information specific to the current invocation of the hook\n   *\n   * The function must either return a replacement object for `obj` or `obj` itself\n   */\n  hook<T: *>(hookName: string, fn: Hook<T, *, *>) {\n    if (!this.hooks[hookName]) {\n      throw new Error(`Sorry, '${hookName}' is not a supported hook`);\n    }\n    if (this._currentPluginName && !fn.displayName) {\n      fn.displayName = `${\n        this._currentPluginName\n      }/${hookName}/${fn.displayName || fn.name || \"anonymous\"}`;\n    }\n    this.hooks[hookName].push(fn);\n  }\n\n  applyHooks<T: *, Context>(\n    build: Build,\n    hookName: string,\n    input: T,\n    context: Context,\n    debugStr: string = \"\"\n  ): T {\n    if (!input) {\n      throw new Error(\"applyHooks was called with falsy input\");\n    }\n    this.depth++;\n    try {\n      debug(`${INDENT.repeat(this.depth)}[${hookName}${debugStr}]: Running...`);\n\n      const hooks: Array<Hook<T, *, *>> = this.hooks[hookName];\n      if (!hooks) {\n        throw new Error(`Sorry, '${hookName}' is not a registered hook`);\n      }\n\n      let newObj = input;\n      for (const hook: Hook<T, *, *> of hooks) {\n        this.depth++;\n        try {\n          const hookDisplayName = hook.displayName || hook.name || \"anonymous\";\n          debug(\n            `${INDENT.repeat(\n              this.depth\n            )}[${hookName}${debugStr}]:   Executing '${hookDisplayName}'`\n          );\n          newObj = hook(newObj, build, context);\n          if (!newObj) {\n            throw new Error(\n              `Hook '${hook.displayName ||\n                hook.name ||\n                \"anonymous\"}' for '${hookName}' returned falsy value '${newObj}'`\n            );\n          }\n          debug(\n            `${INDENT.repeat(\n              this.depth\n            )}[${hookName}${debugStr}]:   '${hookDisplayName}' complete`\n          );\n        } finally {\n          this.depth--;\n        }\n      }\n\n      debug(`${INDENT.repeat(this.depth)}[${hookName}${debugStr}]: Complete`);\n\n      return newObj;\n    } finally {\n      this.depth--;\n    }\n  }\n\n  registerWatcher(listen: WatchUnwatch, unlisten: WatchUnwatch) {\n    if (!listen || !unlisten) {\n      throw new Error(\"You must provide both a listener and an unlistener\");\n    }\n    this.watchers.push(listen);\n    this.unwatchers.push(unlisten);\n  }\n\n  createBuild(): Build {\n    const initialBuild: Build = makeNewBuild(this);\n    const build: Build = this.applyHooks(initialBuild, \"build\", initialBuild, {\n      scope: {},\n    });\n    // Bind all functions so they can be dereferenced\n    bindAll(\n      build,\n      Object.keys(build).filter(key => typeof build[key] === \"function\")\n    );\n    Object.freeze(build);\n    this.applyHooks(build, \"init\", {}, { scope: {} });\n    return build;\n  }\n\n  buildSchema(): GraphQLSchema {\n    if (!this._generatedSchema) {\n      const build = this.createBuild();\n      this._generatedSchema = build.newWithHooks(\n        GraphQLSchema,\n        {},\n        { isSchema: true }\n      );\n    }\n    if (!this._generatedSchema) {\n      throw new Error(\"Schema generation failed\");\n    }\n    return this._generatedSchema;\n  }\n\n  async watchSchema(listener: SchemaListener) {\n    if (this._watching || this._busy) {\n      throw new Error(\"We're already watching this schema!\");\n    }\n    try {\n      this._busy = true;\n      this._watching = true;\n      this._explicitSchemaListener = listener;\n      this.triggerChange = () => {\n        this._generatedSchema = null;\n        // XXX: optionally debounce\n        this.emit(\"schema\", this.buildSchema());\n      };\n      if (listener) {\n        this.on(\"schema\", listener);\n      }\n      for (const fn of this.watchers) {\n        await fn(this.triggerChange);\n      }\n      this.emit(\"schema\", this.buildSchema());\n    } finally {\n      this._busy = false;\n    }\n  }\n\n  async unwatchSchema() {\n    if (!this._watching || this._busy) {\n      throw new Error(\"We're not watching this schema!\");\n    }\n    this._busy = true;\n    try {\n      const listener = this._explicitSchemaListener;\n      this._explicitSchemaListener = null;\n      if (listener) {\n        this.removeListener(\"schema\", listener);\n      }\n      if (this.triggerChange) {\n        for (const fn of this.unwatchers) {\n          await fn(this.triggerChange);\n        }\n      }\n      this.triggerChange = null;\n      this._watching = false;\n    } finally {\n      this._busy = false;\n    }\n  }\n}\n\nexport default SchemaBuilder;\n"]}