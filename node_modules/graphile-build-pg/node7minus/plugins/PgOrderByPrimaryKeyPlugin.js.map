{"version":3,"sources":["../../src/plugins/PgOrderByPrimaryKeyPlugin.js"],"names":["PgOrderByPrimaryKeyPlugin","builder","hook","values","extend","introspectionResultsByKind","pgIntrospectionResultsByKind","scope","isPgRowSortEnum","table","pgIntrospection","kind","attributes","attribute","filter","attr","classId","id","primaryKeyConstraint","constraint","con","type","primaryKeys","keyAttributeNums","map","num","PRIMARY_KEY_ASC","value","alias","specs","key","name","unique","PRIMARY_KEY_DESC"],"mappings":";;;;;;kBAGgB,SAASA,yBAAT,CAAmCC,OAAnC,EAA4C;AAC1DA,UAAQC,IAAR,CACE,wBADF,EAEE,UACEC,MADF,eAIK;AAAA,QAFDC,MAEC,QAFDA,MAEC;AAAA,QAFqCC,0BAErC,QAFOC,4BAEP;AAAA,4BADDC,KACC;AAAA,QADQC,eACR,eADQA,eACR;AAAA,QAD0CC,KAC1C,eADyBC,eACzB;;AACH,QAAI,CAACF,eAAD,IAAoB,CAACC,KAArB,IAA8BA,MAAME,IAAN,KAAe,OAAjD,EAA0D;AACxD,aAAOR,MAAP;AACD;AACD,QAAMS,aAAaP,2BAA2BQ,SAA3B,CAAqCC,MAArC,CACjB;AAAA,aAAQC,KAAKC,OAAL,KAAiBP,MAAMQ,EAA/B;AAAA,KADiB,CAAnB;AAGA,QAAMC,uBAAuBb,2BAA2Bc,UAA3B,CAC1BL,MAD0B,CACnB;AAAA,aAAOM,IAAIJ,OAAJ,KAAgBP,MAAMQ,EAA7B;AAAA,KADmB,EAE1BH,MAF0B,CAEnB;AAAA,aAAOM,IAAIC,IAAJ,KAAa,GAApB;AAAA,KAFmB,EAEM,CAFN,CAA7B;AAGA,QAAI,CAACH,oBAAL,EAA2B;AACzB,aAAOf,MAAP;AACD;AACD,QAAMmB,cACJJ,wBACAA,qBAAqBK,gBAArB,CAAsCC,GAAtC,CACE;AAAA,aAAOZ,WAAWE,MAAX,CAAkB;AAAA,eAAQC,KAAKU,GAAL,KAAaA,GAArB;AAAA,OAAlB,EAA4C,CAA5C,CAAP;AAAA,KADF,CAFF;AAKA,WAAOrB,OACLD,MADK,EAEL;AACEuB,uBAAiB;AACfC,eAAO;AACLC,iBAAO,iBADF;AAELC,iBAAOP,YAAYE,GAAZ,CAAgB;AAAA,mBAAO,CAACM,IAAIC,IAAL,EAAW,IAAX,CAAP;AAAA,WAAhB,CAFF;AAGLC,kBAAQ;AAHH;AADQ,OADnB;AAQEC,wBAAkB;AAChBN,eAAO;AACLC,iBAAO,kBADF;AAELC,iBAAOP,YAAYE,GAAZ,CAAgB;AAAA,mBAAO,CAACM,IAAIC,IAAL,EAAW,KAAX,CAAP;AAAA,WAAhB,CAFF;AAGLC,kBAAQ;AAHH;AADS;AARpB,KAFK,EAkBJ,8CAA6CvB,MAAMsB,IAAK,GAlBpD,CAAP;AAoBD,GA5CH;AA8CD,C","file":"PgOrderByPrimaryKeyPlugin.js","sourcesContent":["// @flow\nimport type { Plugin } from \"graphile-build\";\n\nexport default (function PgOrderByPrimaryKeyPlugin(builder) {\n  builder.hook(\n    \"GraphQLEnumType:values\",\n    (\n      values,\n      { extend, pgIntrospectionResultsByKind: introspectionResultsByKind },\n      { scope: { isPgRowSortEnum, pgIntrospection: table } }\n    ) => {\n      if (!isPgRowSortEnum || !table || table.kind !== \"class\") {\n        return values;\n      }\n      const attributes = introspectionResultsByKind.attribute.filter(\n        attr => attr.classId === table.id\n      );\n      const primaryKeyConstraint = introspectionResultsByKind.constraint\n        .filter(con => con.classId === table.id)\n        .filter(con => con.type === \"p\")[0];\n      if (!primaryKeyConstraint) {\n        return values;\n      }\n      const primaryKeys =\n        primaryKeyConstraint &&\n        primaryKeyConstraint.keyAttributeNums.map(\n          num => attributes.filter(attr => attr.num === num)[0]\n        );\n      return extend(\n        values,\n        {\n          PRIMARY_KEY_ASC: {\n            value: {\n              alias: \"primary_key_asc\",\n              specs: primaryKeys.map(key => [key.name, true]),\n              unique: true,\n            },\n          },\n          PRIMARY_KEY_DESC: {\n            value: {\n              alias: \"primary_key_desc\",\n              specs: primaryKeys.map(key => [key.name, false]),\n              unique: true,\n            },\n          },\n        },\n        `Adding primary key asc/desc sort to table '${table.name}'`\n      );\n    }\n  );\n}: Plugin);\n"]}