#!/usr/bin/env node
"use strict";
var path_1 = require("path");
var fs_1 = require("fs");
var http_1 = require("http");
var chalk = require("chalk");
var program = require("commander");
var pg_connection_string_1 = require("pg-connection-string");
var postgraphql_1 = require("./postgraphql");
// tslint:disable no-console
var config = {};
try {
    config = require(process.cwd() + '/.postgraphilerc'); // tslint:disable-line no-var-requires
    if (!config.hasOwnProperty('options')) {
        console.warn('WARNING: Your configuration file does not export any options');
    }
}
catch (error) {
}
// TODO: Demo Postgres database
var DEMO_PG_URL = null;
var manifest = JSON.parse(fs_1.readFileSync(path_1.resolve(__dirname, '../../package.json')).toString());
program
    .version(manifest.version)
    .usage('[options...]')
    .description(manifest.description)
    .option('-c, --connection <string>', 'the Postgres connection. if not provided it will be inferred from your environment, example: postgres://user:password@domain:port/db')
    .option('-s, --schema <string>', 'a Postgres schema to be introspected. Use commas to define multiple schemas', function (option) { return option.split(','); })
    .option('-w, --watch', 'watches the Postgres schema for changes and reruns introspection if a change was detected')
    .option('-n, --host <string>', 'the hostname to be used. Defaults to `localhost`')
    .option('-p, --port <number>', 'the port to be used. Defaults to 5000', parseFloat)
    .option('-m, --max-pool-size <number>', 'the maximum number of clients to keep in the Postgres pool. defaults to 10', parseFloat)
    .option('-r, --default-role <string>', 'the default Postgres role to use when a request is made. supercedes the role used to connect to the database')
    .option('-q, --graphql <path>', 'the route to mount the GraphQL server on. defaults to `/graphql`')
    .option('-i, --graphiql <path>', 'the route to mount the GraphiQL interface on. defaults to `/graphiql`')
    .option('-b, --disable-graphiql', 'disables the GraphiQL interface. overrides the GraphiQL route option')
    .option('--token <identifier>', 'DEPRECATED: use --jwt-token-identifier instead')
    .option('-o, --cors', 'enable generous CORS settings. this is disabled by default, if possible use a proxy instead')
    .option('-a, --classic-ids', 'use classic global id field name. required to support Relay 1')
    .option('-j, --dynamic-json', 'enable dynamic JSON in GraphQL inputs and outputs. uses stringified JSON by default')
    .option('-M, --disable-default-mutations', 'disable default mutations, mutation will only be possible through Postgres functions')
    .option('-l, --body-size-limit <string>', 'set the maximum size of JSON bodies that can be parsed (default 100kB) The size can be given as a human-readable string, such as \'200kB\' or \'5MB\' (case insensitive).')
    .option('--secret <string>', 'DEPRECATED: Use jwt-secret instead')
    .option('-e, --jwt-secret <string>', 'the secret to be used when creating and verifying JWTs. if none is provided auth will be disabled')
    .option('--jwt-audiences <string>', 'DEPRECATED Use jwt-verify-audience instead', function (option) { return option.split(','); })
    .option('--jwt-verify-algorithms <string>', 'a comma separated list of the names of the allowed jwt token algorithms', function (option) { return option.split(','); })
    .option('-A, --jwt-verify-audience <string>', 'a comma separated list of audiences your jwt token can contain. If no audience is given the audience defaults to `postgraphql`', function (option) { return option.split(','); })
    .option('--jwt-verify-clock-tolerance <number>', 'number of seconds to tolerate when checking the nbf and exp claims, to deal with small clock differences among different servers', parseFloat)
    .option('--jwt-verify-id <string>', 'the name of the allowed jwt token id')
    .option('--jwt-verify-ignore-expiration', 'if `true` do not validate the expiration of the token defaults to `false`')
    .option('--jwt-verify-ignore-not-before', 'if `true` do not validate the notBefore of the token defaults to `false`')
    .option('--jwt-verify-issuer <string>', 'a comma separated list of the names of the allowed jwt token issuer', function (option) { return option.split(','); })
    .option('--jwt-verify-subject <string>', 'the name of the allowed jwt token subject')
    .option('--jwt-role <string>', 'a comma seperated list of strings that create a path in the jwt from which to extract the postgres role. if none is provided it will use the key `role` on the root of the jwt.', function (option) { return option.split(','); })
    .option('-t, --jwt-token-identifier <identifier>', 'the Postgres identifier for a composite type that will be used to create JWT tokens')
    .option('--append-plugins <string>', 'a comma-separated list of plugins to append to the list of GraphQL schema plugins')
    .option('--prepend-plugins <string>', 'a comma-separated list of plugins to prepend to the list of GraphQL schema plugins')
    .option('--export-schema-json <path>', 'enables exporting the detected schema, in JSON format, to the given location. The directories must exist already, if the file exists it will be overwritten.')
    .option('--export-schema-graphql <path>', 'enables exporting the detected schema, in GraphQL schema format, to the given location. The directories must exist already, if the file exists it will be overwritten.')
    .option('--show-error-stack [setting]', 'show JavaScript error stacks in the GraphQL result errors')
    .option('--extended-errors <string>', 'a comma separated list of extended Postgres error fields to display in the GraphQL result. Example: \'hint,detail,errcode\'. Default: none', function (option) { return option.split(',').filter(function (_) { return _; }); })
    .option('--write-cache <path>', 'writes computed values to local cache file so startup can be faster (do this during the build phase)')
    .option('--read-cache <path>', 'reads cached values from local cache file to improve startup time (you may want to do this in production)');
program.on('--help', function () { return console.log("\n  Get Started:\n\n    $ postgraphql --demo\n    $ postgraphql --schema my_schema\n".slice(1)); });
program.parse(process.argv);
// Kill server on exit.
process.on('SIGINT', process.exit);
// Destruct our configuration file and command line arguments, use defaults, and rename options to
// something appropriate for JavaScript.
var _a = Object.assign({}, config['options'], program), _b = _a.demo, isDemo = _b === void 0 ? false : _b, pgConnectionString = _a.connection, watchPg = _a.watch, dbSchema = _a.schema, _c = _a.host, hostname = _c === void 0 ? 'localhost' : _c, _d = _a.port, port = _d === void 0 ? 5000 : _d, maxPoolSize = _a.maxPoolSize, pgDefaultRole = _a.defaultRole, _e = _a.graphql, graphqlRoute = _e === void 0 ? '/graphql' : _e, _f = _a.graphiql, graphiqlRoute = _f === void 0 ? '/graphiql' : _f, _g = _a.disableGraphiql, disableGraphiql = _g === void 0 ? false : _g, deprecatedJwtSecret = _a.secret, jwtSecret = _a.jwtSecret, jwtAudiences = _a.jwtAudiences, jwtVerifyAlgorithms = _a.jwtVerifyAlgorithms, jwtVerifyAudience = _a.jwtVerifyAudience, jwtVerifyClockTolerance = _a.jwtVerifyClockTolerance, jwtVerifyId = _a.jwtVerifyId, jwtVerifyIgnoreExpiration = _a.jwtVerifyIgnoreExpiration, jwtVerifyIgnoreNotBefore = _a.jwtVerifyIgnoreNotBefore, jwtVerifyIssuer = _a.jwtVerifyIssuer, jwtVerifySubject = _a.jwtVerifySubject, _h = _a.jwtRole, jwtRole = _h === void 0 ? ['role'] : _h, deprecatedJwtPgTypeIdentifier = _a.token, jwtPgTypeIdentifier = _a.jwtTokenIdentifier, _j = _a.cors, enableCors = _j === void 0 ? false : _j, _k = _a.classicIds, classicIds = _k === void 0 ? false : _k, _l = _a.dynamicJson, dynamicJson = _l === void 0 ? false : _l, _m = _a.disableDefaultMutations, disableDefaultMutations = _m === void 0 ? false : _m, exportJsonSchemaPath = _a.exportSchemaJson, exportGqlSchemaPath = _a.exportSchemaGraphql, showErrorStack = _a.showErrorStack, _o = _a.extendedErrors, extendedErrors = _o === void 0 ? [] : _o, bodySizeLimit = _a.bodySizeLimit, appendPluginNames = _a.appendPlugins, prependPluginNames = _a.prependPlugins, 
// replaceAllPlugins is NOT exposed via the CLI
readCache = _a.readCache, writeCache = _a.writeCache;
// Add custom logic for getting the schemas from our CLI. If we are in demo
// mode, we want to use the `forum_example` schema. Otherwise the `public`
// schema is what we want.
var schemas = dbSchema || (isDemo ? ['forum_example'] : ['public']);
// Create our Postgres config.
var pgConfig = Object.assign({}, 
// If we have a Postgres connection string, parse it and use that as our
// config. If we donâ€™t have a connection string use some environment
// variables or final defaults. Other environment variables should be
// detected and used by `pg`.
pgConnectionString || process.env.DATABASE_URL || isDemo ?
    pg_connection_string_1.parse(pgConnectionString || process.env.DATABASE_URL || DEMO_PG_URL) : {
    host: process.env.PGHOST || 'localhost',
    port: process.env.PGPORT || 5432,
    database: process.env.PGDATABASE,
    user: process.env.PGUSER,
    password: process.env.PGPASSWORD,
}, 
// Add the max pool size to our config.
{ max: maxPoolSize });
var loadPlugins = function (rawNames) {
    if (!rawNames) {
        return undefined;
    }
    var names = String(rawNames).split(',');
    return names.map(function (rawName) {
        var name = String(rawName);
        var parts = name.split(':');
        var root;
        try {
            root = require(String(parts.shift()));
        }
        catch (e) {
            // tslint:disable-next-line no-console
            console.error("Failed to load plugin '" + name + "'");
            throw e;
        }
        var plugin = root;
        while (true) {
            var part = parts.shift();
            if (part == null) {
                break;
            }
            plugin = root[part];
            if (plugin == null) {
                throw new Error("No plugin found matching spec '" + name + "' - failed at '" + part + "'");
            }
        }
        if (typeof plugin === 'function') {
            return plugin;
        }
        else if (plugin === root && typeof plugin.default === 'function') {
            return plugin.default; // ES6 workaround
        }
        else {
            throw new Error("No plugin found matching spec '" + name + "' - expected function, found '" + typeof plugin + "'");
        }
    });
};
if (jwtAudiences && jwtVerifyAudience) {
    throw new Error("Provide either '--jwt-audiences' or '-A, --jwt-verify-audience' but not both");
}
var jwtVerifyOptions = {
    algorithms: jwtVerifyAlgorithms,
    audience: jwtVerifyAudience,
    clockTolerance: jwtVerifyClockTolerance,
    jwtId: jwtVerifyId,
    ignoreExpiration: jwtVerifyIgnoreExpiration,
    ignoreNotBefore: jwtVerifyIgnoreNotBefore,
    issuer: jwtVerifyIssuer,
    subject: jwtVerifySubject,
};
// Createâ€™s our PostGraphQL server and provides all the appropriate
// configuration options.
var server = http_1.createServer(postgraphql_1.default(pgConfig, schemas, {
    classicIds: classicIds,
    dynamicJson: dynamicJson,
    disableDefaultMutations: disableDefaultMutations,
    graphqlRoute: graphqlRoute,
    graphiqlRoute: graphiqlRoute,
    graphiql: !disableGraphiql,
    jwtPgTypeIdentifier: jwtPgTypeIdentifier || deprecatedJwtPgTypeIdentifier,
    jwtSecret: jwtSecret || deprecatedJwtSecret,
    jwtAudiences: jwtAudiences,
    jwtRole: jwtRole,
    jwtVerifyOptions: jwtVerifyOptions,
    pgDefaultRole: pgDefaultRole,
    watchPg: watchPg,
    showErrorStack: showErrorStack,
    extendedErrors: extendedErrors,
    disableQueryLog: false,
    enableCors: enableCors,
    exportJsonSchemaPath: exportJsonSchemaPath,
    exportGqlSchemaPath: exportGqlSchemaPath,
    bodySizeLimit: bodySizeLimit,
    appendPlugins: loadPlugins(appendPluginNames),
    prependPlugins: loadPlugins(prependPluginNames),
    readCache: readCache,
    writeCache: writeCache,
}));
// Start our server by listening to a specific port and host name. Also log
// some instructions and other interesting information.
server.listen(port, hostname, function () {
    console.log('');
    console.log("PostGraphQL server listening on port " + chalk.underline(server.address().port.toString()) + " \uD83D\uDE80");
    console.log('');
    console.log("  \u2023 Connected to Postgres instance " + chalk.underline.blue(isDemo ? 'postgraphql_demo' : "postgres://" + pgConfig.host + ":" + (pgConfig.port || 5432) + (pgConfig.database != null ? "/" + pgConfig.database : '')));
    console.log("  \u2023 Introspected Postgres schema(s) " + schemas.map(function (schema) { return chalk.magenta(schema); }).join(', '));
    console.log("  \u2023 GraphQL endpoint served at " + chalk.underline("http://" + hostname + ":" + port + graphqlRoute));
    if (!disableGraphiql)
        console.log("  \u2023 GraphiQL endpoint served at " + chalk.underline("http://" + hostname + ":" + port + graphiqlRoute));
    console.log('');
    console.log(chalk.gray('* * *'));
    console.log('');
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xpLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3Bvc3RncmFwaHFsL2NsaS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUVBLDZCQUE2QztBQUM3Qyx5QkFBaUM7QUFDakMsNkJBQW1DO0FBQ25DLDZCQUErQjtBQUMvQixtQ0FBcUM7QUFFckMsNkRBQXVFO0FBQ3ZFLDZDQUF1QztBQUV2Qyw0QkFBNEI7QUFFNUIsSUFBSSxNQUFNLEdBQUcsRUFBRSxDQUFBO0FBQ2YsSUFBSSxDQUFDO0lBQ0gsTUFBTSxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLEdBQUcsa0JBQWtCLENBQUMsQ0FBQSxDQUFDLHNDQUFzQztJQUMzRixFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxjQUFjLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3RDLE9BQU8sQ0FBQyxJQUFJLENBQUMsOERBQThELENBQUMsQ0FBQTtJQUM5RSxDQUFDO0FBQ0gsQ0FBQztBQUFDLEtBQUssQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7QUFFakIsQ0FBQztBQUNELCtCQUErQjtBQUMvQixJQUFNLFdBQVcsR0FBRyxJQUFJLENBQUE7QUFFeEIsSUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxpQkFBWSxDQUFDLGNBQVcsQ0FBQyxTQUFTLEVBQUUsb0JBQW9CLENBQUMsQ0FBQyxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUE7QUFFbEcsT0FBTztLQUNKLE9BQU8sQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDO0tBQ3pCLEtBQUssQ0FBQyxjQUFjLENBQUM7S0FDckIsV0FBVyxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUM7S0FFakMsTUFBTSxDQUFDLDJCQUEyQixFQUFFLHNJQUFzSSxDQUFDO0tBQzNLLE1BQU0sQ0FBQyx1QkFBdUIsRUFBRSw2RUFBNkUsRUFBRSxVQUFDLE1BQWMsSUFBSyxPQUFBLE1BQU0sQ0FB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